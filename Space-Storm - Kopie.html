<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Space-Storm - a fighting game</title>

<script type="text/javascript">
    
    document.addEventListener("keydown",keyPush);  
    document.addEventListener("mousemove", mouseMoveHandler, false);
    window.addEventListener('mousedown',mouseKlickHandler,false);

    
    // ----- VARIABLEN:
    
    var level = 0;          // An Anfang Level 0 = Startbildschirm
    
    var maus_x = 0;     // Variablen f. Koordinaten d. Mauszeigers
    var maus_y = 0;     // sichtbar f. alle Funktionen!
    var klick = false;  // wurde schon Maustaste gedrückt?
	
	var points = 0;
	
	var points_boss = 0;
	
	var leben = 5;
	
	var geschossen = false;
	
    
    var jump = false;
    var y = 0;              // Höhe der Barriere
    var frames = 0;         // Zähler für Zeit bzw. Frames
    var soundJump = new Audio('');
    var soundFail = new Audio('');
	
	var LastMousePosition = 0;

    

        

        
    var imageBand = new Image(); 
    imageBand.src = "assets/pics/band.png";
    
    var imageButtonStart = new Image();
    imageButtonStart.src = "assets/pics/button1.png";
    
    var imageButtonHelp = new Image();
    imageButtonHelp.src = "assets/pics/button2.png";
    
    var imageButtonCredits = new Image();
    imageButtonCredits.src = "assets/pics/button3.png";
    
    var imageMauszeiger = new Image();
    imageMauszeiger.src = "assets/pics/leer.png";
	
    var imageSpace = new Image(); 
    imageSpace.src = "assets/pics/space(1).png";
	
	var imageBrett = new Image();
	imageBrett.src = "assets/pics/blaster.png";
	
	var imageGeschoss = new Image();
	imageGeschoss.src = "assets/pics/schüsse3.png";
	
	var imageAlien = new Image();
	imageAlien.src = "assets/pics/Alien.png";
	
	var imageBoss = new Image();
	imageBoss.src = "assets/pics/Boss.png";

	
    
    // -----  KONSTRUKTOREN: 
    
    function makeFigur(image, x_pos, y_pos) {
            this.bild = image;
            this.x = x_pos;
            this.y = y_pos;     // Position (x, y)
            
            this.vx = 0;
            this.vy = 0;        // Geschwindigkeit in x bzw. y-Richtung
            
            this.width = 100;    
            this.height = 100;        
            
            this.move = function(){
                // Figur bewegen und dann für ein Frame anzeigen
                this.x = this.x + this.vx;
                this.y = this.y + this.vy;
                ctx.drawImage(image, this.x, this.y);
            }

            this.draw = function(){
                // Figur einfach nur anzeigen
                ctx.drawImage(image, this.x, this.y);
            }
            
            this.crashWith = function(otherobj) {   
                // Diese Funktion prüft, ob dieses Objekt "this" mit einem anderen 
                // Objekt kollidiert ("other"). 
                // Danke: https://www.w3schools.com/graphics/game_obstacles.asp
                var myleft = this.x;
                var myright = this.x + (this.width);
                var mytop = this.y;
                var mybottom = this.y + (this.height);
                var otherleft = otherobj.x;
                var otherright = otherobj.x + (otherobj.width);
                var othertop = otherobj.y;
                var otherbottom = otherobj.y + (otherobj.height);
                var crash = true;
                if ((mybottom < othertop) ||
                    (mytop > otherbottom) ||
                    (myright < otherleft) ||
                    (myleft > otherright)) {
                    crash = false;
                }
                return crash;
            }  
        }
    
    // -----  OBJEKTE: 
    
    // neue Figur (= Instanz) erzeugen:

    
    var BandUnten = new makeFigur(imageBand, 800, 350 );
    BandUnten.vx = -7;
    BandUnten.height= 1000;
    
    var BandOben = new makeFigur(imageBand, 800, -900) ;
    BandOben.vx = -7;
    BandOben.height = 1000;
    
    // auch Buttons und Mauszeiger sind Figuren:
    
    var ButtonStart = new makeFigur(imageButtonStart, 200, 140);
    ButtonStart.width = 400;
    
    var ButtonHelp = new makeFigur(imageButtonHelp, 200, 260);
    ButtonHelp.width = 400;
    
    var ButtonCredits = new makeFigur(imageButtonCredits, 200, 380);
    ButtonCredits.width = 400;
	
	var Space = new makeFigur(imageSpace, 0, 0);
	
	var Brett = new makeFigur(imageBrett, 290, 500);
	
	var Geschoss = new makeFigur(imageGeschoss, 200, 450);
    
    var Mauszeiger = new makeFigur(imageMauszeiger, maus_x, maus_y);
    Mauszeiger.width = 1; 
    Mauszeiger.height = 1;
	
	var Alien = new makeFigur(imageAlien, 290, 0);
	Alien.width = 100;
	Alien.height = 100;
	
	var Boss = new makeFigur(imageBoss, 450, 0);
	Boss.width = 100;
	Boss.height = 100;
    
    // ----- FUNKTIONEN: 
    
    function nachLaden(){         
        
        canv=document.getElementById("gc");     // Canvas aus HTML Teil ansteuern
        ctx=canv.getContext("2d");              // Kontext zum "zeichnen" festlegen        
        // Die Funktion "keydown" aufrufen, wenn eine Taste gedrückt wurde
        //  Konstruktor-Funktion für beliebige Figur
        setInterval(game,1000/60);
    }
    
    function level_menu(){
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0,0,1000,800);   // canvas leeren bevor etw. neues gezeichnet wird
		
		ctx.fillStyle = "royalblue";
        ctx.fillRect(0,0,800,800);   // canvas leeren bevor etw. neues gezeichnet wird
		
		
		
        
        ctx.fillStyle = "#000066";     // Dunkelblaue Schrift
        ctx.font = "55px Comic Sans";
        ctx.fillText("Space-Storm - a fighting game", 90, 65);
                
        ctx.font = "45px Arial";
        ctx.fillText("", 160, 550);
        
        ButtonStart.draw();
        ButtonHelp.draw();
        ButtonCredits.draw();
        
        Mauszeiger.x = maus_x;      // Mauszeiger Position muss jedes Frame neu
        Mauszeiger.y = maus_y;      //   ausgelesen werden!
        
        if( Mauszeiger.crashWith(ButtonStart) && klick == true){
            level = 1;
        }
		if( Mauszeiger.crashWith(ButtonHelp) && klick == true){
            level = 2;
        }
        
        klick = false;      // zurücksetzen nicht vergessen!
    }
    
    function level_1(){
		
		ctx.fillStyle = "#FFFFFF";
		ctx.fillRect(0,0,1000,800);
		Space.draw();
		Brett.draw();
		Brett.x = maus_x - 50;
		Geschoss.move();
		
		if (geschossen == false){
			Geschoss.x = maus_x - 35;
		}
		Alien.move();
		Alien.vy = +10;
		Boss.draw();
		
		ctx.fillStyle = "#000000"; 
		ctx.font = "30px Comic Sans";
        ctx.fillText("Abschüsse: " + points, 820, 500);
		
		ctx.fillStyle = "#000000"; 
		ctx.font = "30px Comic Sans";
        ctx.fillText("Leben: " + leben, 820, 300);
		
		if ( klick == true ){
			Geschoss.vy = -10;
			Geschoss.x = maus_x - 35;
			geschossen = true;
			
			klick = false;
			
		}
		
		if (Geschoss.crashWith(Alien) == true) {
			points = points +1;
			Alien.x = Math.random()*700;
			Alien.y = 0;
			Geschoss.y = 450;
			Geschoss.vy = 0;
			geschossen = false;
		}
		
		if (Geschoss.crashWith(Boss)) {
			points = points +1;
			points_boss = points_boss + 1;
			Boss.x = Math.random()*700;
		}
		
		if (points_boss == 3){
			level = 3;
		}
		
		//if (Geschoss.y <= 1){
			
		//}
		
		if (Geschoss.x >= 700){
			Geschoss.x = 700;
		}
		
		if(Geschoss.y <= 1){
			Geschoss.y = 450;
			Geschoss.vy = 0;
			geschossen = false;
		}
		
		if (Brett.x >= 700){
			Brett.x = 700;
		}
		
		if (Alien.y == 600){
			leben = leben -1;
		}
		
		if (Alien.y >= 600){
			Alien.y = 0;
			//Alien.x = Math.random()*700;
		}
		
		if(leben <= 0){
			level = 3;
		}

		
		
		
	
    }
        
    function level_2(){
		ctx.fillStyle = " #8797EF";     //blauer Hintergrund
        ctx.fillRect(0,0,800,800);   // canvas leeren bevor etw. neues gezeichnet wird

                

    }	
	
	
	
	
	
	
	function game(){
        
        if (level ==0){
            level_menu();
        }
        
        else if (level == 1){
            level_1();
        }
		else if (level == 2){
			level_2();
		}	
		else if (level == 3){
			level_menu();
		}
        
    }
    
    function keyPush(evt) {
    switch(evt.keyCode) {
        // keycodes 32 ist die Leertaste
        // siehe: https://www.mediaevent.de/javascript/Extras-Javascript-Keycodes.html
        case 32:
            jump = true;
    }
}
    
    function mouseMoveHandler(e) {
            // Beispiel abgeändert von https://developer.mozilla.org/en-US/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript/Mouse_controls
            
			var relativeX = e.clientX - canv.offsetLeft;
			if (relativeX > 0 && relativeX < canv.width) {
				maus_x = relativeX;
			}
			var relativeY = e.clientY - canv.offsetLeft;
			if (relativeY > 0 && relativeY < canv.height) {
				maus_y = relativeY;
			}
		}
    
    function mouseKlickHandler(){
		if (geschossen == false){
			klick = true;
		}
    }
	
	
	
	
	
	
	


</script>

</head>
<!-- oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo -->

<body onload="nachLaden();">
 <canvas   id="gc" width="1000" height="600"></canvas>
</body>
</html>
